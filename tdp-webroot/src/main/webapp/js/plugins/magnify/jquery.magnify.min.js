!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){var i=t.match(/\d+/g);return parseFloat(i[0])}function e(t,i,e,o){var a=o?t.h:t.w,s=o?t.w:t.h;(s>i.h||a>i.w)&&e.addClass("is-grab"),s<=i.h&&a<=i.w&&e.removeClass("is-grab")}function o(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}var a=t(window),s=t(document),n={draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.1,maxRatio:16,headToolbar:["maximize","close"],footToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{maximize:"fa fa-window-maximize",close:"fa fa-close",zoomIn:"fa fa-search-plus",zoomOut:"fa fa-search-minus",prev:"fa fa-arrow-left",next:"fa fa-arrow-right",fullscreen:"fa fa-photo",actualSize:"fa fa-arrows-alt",rotateLeft:"fa fa-rotate-left",rotateRight:"fa fa-rotate-right",loading:"fa fa-spinner fa-pulse"},i18n:{maximize:"maximize",close:"close",zoomIn:"zoom-in",zoomOut:"zoom-out",prev:"prev",next:"next",fullscreen:"fullscreen",actualSize:"actual-size",rotateLeft:"rotate-left",rotateRight:"rotate-right"},multiInstances:!0},h=null,l=!1,r=!1,g=!1,d=!1,f=!1,c=0,m={start:o()?"touchstart":"mousedown",move:o()?"touchmove":"mousemove",end:o()?"touchend":"mouseup"},u=function(i,e){this.options=t.extend(!0,{},n,e),e&&t.isArray(e.footToolbar)&&(this.options.footToolbar=e.footToolbar),e&&t.isArray(e.headToolbar)&&(this.options.headToolbar=e.headToolbar),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(i,this.options)};u.prototype={init:function(i,e){var o=this.getImgSrc(i);this.groupName=null;var a=t(i).attr("data-group"),n=s.find('[data-group="'+a+'"]');void 0!==a?(this.groupName=a,this.getImgGroup(n,o)):this.getImgGroup(h.not("[data-group]"),o),this.open(),this.loadImg(o),this.options.draggable&&this.draggable(this.$magnify,this.$magnify,".magnify-button"),this.options.movable&&this.movable(this.$stage,this.$image),this.options.resizable&&this.resizable(this.$magnify,this.$stage,this.$image,this.options.modalWidth,this.options.modalHeight)},creatBtns:function(i,e){var o="";return t.each(i,function(t,i){o+=e[i]}),o},creatDOM:function(){var t={maximize:'<button class="magnify-button magnify-button-maximize" title="'+this.options.i18n.maximize+'">                      <i class="'+this.options.icons.maximize+'" aria-hidden="true"></i>                    </button>',close:'<button class="magnify-button magnify-button-close" title="'+this.options.i18n.close+'">                      <i class="'+this.options.icons.close+'" aria-hidden="true"></i>                    </button>',zoomIn:'<button class="magnify-button magnify-button-zoom-in" title="'+this.options.i18n.zoomIn+'">                      <i class="'+this.options.icons.zoomIn+'" aria-hidden="true"></i>                    </button>',zoomOut:'<button class="magnify-button magnify-button-zoom-out" title="'+this.options.i18n.zoomOut+'">                      <i class="'+this.options.icons.zoomOut+'" aria-hidden="true"></i>                    </button>',prev:'<button class="magnify-button magnify-button-prev" title="'+this.options.i18n.prev+'">                      <i class="'+this.options.icons.prev+'" aria-hidden="true"></i>                    </button>',next:'<button class="magnify-button magnify-button-next" title="'+this.options.i18n.next+'">                      <i class="'+this.options.icons.next+'" aria-hidden="true"></i>                    </button>',fullscreen:'<button class="magnify-button magnify-button-fullscreen" title="'+this.options.i18n.fullscreen+'">                      <i class="'+this.options.icons.fullscreen+'" aria-hidden="true"></i>                    </button>',actualSize:'<button class="magnify-button magnify-button-actual-size" title="'+this.options.i18n.actualSize+'">                      <i class="'+this.options.icons.actualSize+'" aria-hidden="true"></i>                    </button>',rotateLeft:'<button class="magnify-button magnify-button-rotate-left" title="'+this.options.i18n.rotateLeft+'">                      <i class="'+this.options.icons.rotateLeft+'" aria-hidden="true"></i>                    </button>',rotateRight:'<button class="magnify-button magnify-button-rotate-right" title="'+this.options.i18n.rotateRight+'">                      <i class="'+this.options.icons.rotateRight+'" aria-hidden="true"></i>                    </button>'};return'<div class="magnify-modal">                          <div class="magnify-header">                              <div class="magnify-title"></div>                              <div class="magnify-toolbar">'+this.creatBtns(this.options.headToolbar,t)+'</div>                          </div>                          <div class="magnify-stage">                              <img class="magnify-image" src="" alt="" />                          </div>                          <div class="magnify-footer">                              <div class="magnify-toolbar">'+this.creatBtns(this.options.footToolbar,t)+"</div>                          </div>                      </div>"},open:function(){if(this.options.multiInstances||t(".magnify-modal").eq(0).remove(),!t(".magnify-modal").length&&this.options.fixedContent&&(t("html").css({overflow:"hidden"}),document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight))){var i=function(){var t=document.createElement("div");t.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i}();i&&t("html").css({"padding-right":i})}this.isOpened=g=!0,this.build(),this.setModalPos(this.$magnify)},build:function(){var i=this.creatDOM(),e=t(i);this.$magnify=e,this.$header=e.find(".magnify-header"),this.$stage=e.find(".magnify-stage"),this.$title=e.find(".magnify-title"),this.$image=e.find(".magnify-image"),this.$close=e.find(".magnify-button-close"),this.$maximize=e.find(".magnify-button-maximize"),this.$zoomIn=e.find(".magnify-button-zoom-in"),this.$zoomOut=e.find(".magnify-button-zoom-out"),this.$actualSize=e.find(".magnify-button-actual-size"),this.$fullscreen=e.find(".magnify-button-fullscreen"),this.$rotateLeft=e.find(".magnify-button-rotate-left"),this.$rotateRight=e.find(".magnify-button-rotate-right"),this.$prev=e.find(".magnify-button-prev"),this.$next=e.find(".magnify-button-next"),t("body").append(e)},close:function(i){this.$magnify.remove(),this.isMaximized=d=!1,this.isRotated=f=!1,this.rotateAngle=c=0,this.isOpened=g=!1,!t(".magnify-modal").length&&this.options.fixedContent&&t("html").css({overflow:"","padding-right":""}),t(".magnify-modal").length||(a.off("resize"),s.off("mousemove mouseup"))},setModalPos:function(t){var i=a.width(),e=a.height(),o=s.scrollLeft(),n=s.scrollTop(),h=t.width(),l=t.height();t.css({left:(i-h)/2+o+"px",top:(e-l)/2+n+"px"})},setModalSize:function(t){var e=a.width(),o=a.height(),n=s.scrollLeft(),h=s.scrollTop(),l={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},r=t.width+i(l.left)+i(l.right)+i(l.borderLeft)+i(l.borderRight),g=t.height+i(l.top)+i(l.bottom)+i(l.borderTop)+i(l.borderBottom),d=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,f=Math.min(e/(r*d),o/(g*d),1),c=Math.max(r*f,this.options.modalWidth),m=Math.max(g*f,this.options.modalHeight);c=this.options.fixedModalSize?this.options.modalWidth:Math.ceil(c),m=this.options.fixedModalSize?this.options.modalHeight:Math.ceil(m),this.$magnify.css({width:c+"px",height:m+"px",left:(e-c)/2+n+"px",top:(o-m)/2+h+"px"}),this.setImageSize(t)},setImageSize:function(i){var o={w:this.$stage.width(),h:this.$stage.height()},a=1;a=this.isRotated?Math.min(o.w/i.height,o.h/i.width,1):Math.min(o.w/i.width,o.h/i.height,1),this.$image.css({width:Math.floor(i.width*a)+"px",height:Math.floor(i.height*a)+"px",left:(o.w-i.width*a)/2+"px",top:(o.h-i.height*a)/2+"px"}),t.extend(this.imageData,{width:i.width*a,height:i.height*a,left:(o.w-i.width*a)/2,top:(o.h-i.height*a)/2}),e({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated)},loadImg:function(t){var i=this,e='<div class="magnify-loading"><i class="'+this.options.icons.loading+'"></i></div>';this.$magnify.append(e),this.options.initMaximized&&(this.$magnify.addClass("magnify-maximize"),this.$magnify.css({width:"100%",height:"100%",left:s.scrollLeft(),top:s.scrollTop()}),this.isMaximized=!0),this.$image.attr("src",t),function(t,i,e){var o=new Image;o.onload=function(){i(o)},o.onerror=function(){e(o)},o.src=t}(t,function(t){i.imageData={originalWidth:t.width,originalHeight:t.height},i.isMaximized?i.setImageSize(t):i.setModalSize(t),i.$magnify.find(".magnify-loading").remove(),i.addEvent()},function(){i.$magnify.find(".magnify-loading").remove(),i.addEvent()}),this.options.title&&this.setImgTitle(t)},getImgGroup:function(i,e){var o=this;o.groupData=[],t(i).each(function(i,a){var s=o.getImgSrc(this);o.groupData.push({src:s,caption:t(this).attr("data-caption")}),e===s&&(o.groupIndex=i)})},setImgTitle:function(t){var i=this.groupIndex,e=(e=this.groupData[i].caption)||function(t){return t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1")}(t);this.$title.text(e)},getImgSrc:function(i){return t(i).attr("data-src")?t(i).attr("data-src"):t(i).attr("href")},jump:function(t){this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)},jumpTo:function(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImg(this.groupData[t].src)},wheel:function(t){t.preventDefault();var i=1;t.originalEvent.deltaY?i=t.originalEvent.deltaY>0?1:-1:t.originalEvent.wheelDelta?i=-t.originalEvent.wheelDelta/120:t.originalEvent.detail&&(i=t.originalEvent.detail>0?1:-1);var e=-i*this.options.ratioThreshold,o={x:t.originalEvent.clientX-this.$stage.offset().left+s.scrollLeft(),y:t.originalEvent.clientY-this.$stage.offset().top+s.scrollTop()};this.zoom(e,o,t)},zoom:function(t,i,e){(t=t<0?1/(1-t):1+t)>.95&&t<1.05&&(t=1),t=this.$image.width()/this.imageData.originalWidth*t,t=Math.max(t,this.options.minRatio),t=Math.min(t,this.options.maxRatio),this.zoomTo(t,i,e)},zoomTo:function(i,o,a){var s=this.$image,n=this.$stage,h={w:this.imageData.width,h:this.imageData.height,x:this.imageData.left,y:this.imageData.top},l={w:n.width(),h:n.height(),x:n.offset().left,y:n.offset().top},r=this.imageData.originalWidth*i,g=this.imageData.originalHeight*i,d=o.x-(o.x-h.x)/h.w*r,f=o.y-(o.y-h.y)/h.h*g,c=this.isRotated?(r-g)/2:0,m=this.isRotated?g:r,u=this.isRotated?r:g,p=l.w-r,x=l.h-g;
// The conditions with image rotate 90 degree drive me crazy alomst!
f=u<=l.h?(l.h-g)/2:f>c?c:f>x-c?f:x-c,d=m<=l.w?(l.w-r)/2:d>-c?-c:d>p+c?d:p+c,s.css({width:Math.ceil(r)+"px",height:Math.ceil(g)+"px",left:d+"px",top:f+"px"}),t.extend(this.imageData,{width:r,height:g,left:d,top:f}),e({w:m,h:u},{w:l.w,h:l.h},this.$stage)},rotate:function(t){this.rotateAngle=c=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)},rotateTo:function(t){this.$image.css({transform:"rotate("+t+"deg)"}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")},resize:function(){var t=this;return function(t,i){var e=null;return function(){var o=this,a=arguments;clearTimeout(e),e=setTimeout(function(){t.apply(o,a)},i)}}(function(){t.isOpened&&(t.isMaximized||t.setModalSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}),t.setImageSize({width:t.imageData.originalWidth,height:t.imageData.originalHeight}))},500)},maximize:function(){this.isMaximized?(this.$magnify.removeClass("magnify-maximize"),this.$magnify.css({width:this.modalData.width?this.modalData.width:this.options.modalWidth,height:this.modalData.height?this.modalData.height:this.options.modalHeight,left:this.modalData.left?this.modalData.left:(a.width()-this.options.modalWidth)/2+s.scrollLeft(),top:this.modalData.top?this.modalData.top:(a.height()-this.options.modalHeight)/2+s.scrollTop()}),this.isMaximized=!1):(this.modalData={width:this.$magnify.width(),height:this.$magnify.height(),left:this.$magnify.offset().left,top:this.$magnify.offset().top},this.$magnify.addClass("magnify-maximize"),this.$magnify.css({width:"100%",height:"100%",left:s.scrollLeft(),top:s.scrollTop()}),this.isMaximized=!0),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight})},fullscreen:function(){!function(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}(this.$magnify[0])},keydown:function(t){if(!this.options.keyboard)return!1;var i=t.keyCode||t.which||t.charCode,e=t.ctrlKey||t.metaKey,o=t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 187:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 189:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 61:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 173:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 48:e&&o&&this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 188:e&&this.rotate(-90);break;case 190:e&&this.rotate(90)}},addEvent:function(){var t=this;this.$close.off("click").on("click",function(i){t.close()}),this.$stage.off("wheel mousewheel DOMMouseScroll").on("wheel mousewheel DOMMouseScroll",function(i){t.wheel(i)}),this.$zoomIn.off("click").on("click",function(i){t.zoom(3*t.options.ratioThreshold,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$zoomOut.off("click").on("click",function(i){t.zoom(3*-t.options.ratioThreshold,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$actualSize.off("click").on("click",function(i){t.zoomTo(1,{x:t.$stage.width()/2,y:t.$stage.height()/2},i)}),this.$prev.off("click").on("click",function(){t.jump(-1)}),this.$fullscreen.off("click").on("click",function(){t.fullscreen()}),this.$next.off("click").on("click",function(){t.jump(1)}),this.$rotateLeft.off("click").on("click",function(){t.rotate(-90)}),this.$rotateRight.off("click").on("click",function(){t.rotate(90)}),this.$maximize.off("click").on("click",function(){t.maximize()}),s.off("keydown").on("keydown",function(i){t.keydown(i)}),a.on("resize",t.resize())}},t.magnify={instance:u.prototype},t.fn.magnify=function(i){return h=t(this),"string"==typeof i||h.off("click.magnify").on("click.magnify",function(e){e.isDefaultPrevented()||(e.preventDefault(),t(this).data("magnify",new u(this,i)))}),h},s.on("click.magnify","[data-magnify]",function(i){h=t("[data-magnify]"),i.isDefaultPrevented()||(i.preventDefault(),t(this).data("magnify",new u(this,{})))});t.extend(u.prototype,{draggable:function(i,e,o){var a=this,n=!1,h=0,g=0,d=0,f=0;t(e).on(m.start,function(e){if((e=e||window.event).preventDefault(),t(e.target).closest(o).length)return!0;n=!0,h="touchstart"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,g="touchstart"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,d=t(i).offset().left,f=t(i).offset().top}),s.on(m.move,function(e){if((e=e||window.event).preventDefault(),n&&!l&&!r&&!a.isMaximized){var o="touchmove"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,s="touchmove"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,c=o-h,m=s-g;t(i).css({left:c+d+"px",top:m+f+"px"})}}),s.on(m.end,function(t){n=!1})}});t.extend(u.prototype,{movable:function(i,e){var o=this,a=!1,n=0,h=0,r=0,g=0,d=0,f=0,c=0;t(i).on(m.start,function(s){(s=s||window.event).preventDefault();var m=t(e).width(),u=t(e).height(),p=t(i).width(),x=t(i).height();n="touchstart"===s.type?s.originalEvent.targetTouches[0].pageX:s.clientX,h="touchstart"===s.type?s.originalEvent.targetTouches[0].pageY:s.clientY,c=o.isRotated?(m-u)/2:0,d=o.isRotated?u-p:m-p,f=o.isRotated?m-x:u-x,a=d>0||f>0,l=d>0||f>0,r=t(e).position().left-c,g=t(e).position().top+c,i.hasClass("is-grab")&&t("html,body,.magnify-modal,.magnify-stage,.magnify-button,.resizable-handle").addClass("is-grabbing")}),s.on(m.move,function(i){if((i=i||window.event).preventDefault(),a){var s="touchmove"===i.type?i.originalEvent.targetTouches[0].pageX:i.clientX,l="touchmove"===i.type?i.originalEvent.targetTouches[0].pageY:i.clientY,m=s-n,u=l-h,p=m+r,x=u+g;f>0?u+g>c?x=c:u+g<-f+c&&(x=-f+c):x=g,d>0?m+r>-c?p=-c:m+r<-d-c&&(p=-d-c):p=r,t(e).css({left:p+"px",top:x+"px"}),t.extend(o.imageData,{left:p,top:x})}}),s.on(m.end,function(i){a=!1,l=!1,t("html,body,.magnify-modal,.magnify-stage,.magnify-button,.resizable-handle").removeClass("is-grabbing")})}});t.extend(u.prototype,{resizable:function(i,o,a,n,h){var l=this,g=t('<div class="resizable-handle resizable-handle-e"></div>'),d=t('<div class="resizable-handle resizable-handle-w"></div>'),f=t('<div class="resizable-handle resizable-handle-s"></div>'),c=t('<div class="resizable-handle resizable-handle-n"></div>'),u=t('<div class="resizable-handle resizable-handle-se"></div>'),p=t('<div class="resizable-handle resizable-handle-sw"></div>'),x=t('<div class="resizable-handle resizable-handle-ne"></div>'),w=t('<div class="resizable-handle resizable-handle-nw"></div>'),y={e:g,s:f,se:u,n:c,w:d,nw:w,ne:x,sw:p};t(i).append(g,d,f,c,u,p,x,w);var v=!1,b=0,z=0,$={w:0,h:0,l:0,t:0},D={w:0,h:0,l:0,t:0},T={w:0,h:0,l:0,t:0},M=0,k=0,R=0,I="",S=function(e,s){(s=s||window.event).preventDefault(),v=!0,r=!0,b="touchstart"===s.type?s.originalEvent.targetTouches[0].pageX:s.clientX,z="touchstart"===s.type?s.originalEvent.targetTouches[0].pageY:s.clientY,$={w:t(i).width(),h:t(i).height(),l:t(i).offset().left,t:t(i).offset().top},D={w:t(o).width(),h:t(o).height(),l:t(o).offset().left,t:t(o).offset().top},T={w:t(a).width(),h:t(a).height(),l:t(a).position().left,t:t(a).position().top},M=l.isRotated?(T.w-T.h)/2:0,k=l.isRotated?T.h:T.w,R=l.isRotated?T.w:T.h,I=e,t("html,body,.magnify-modal,.magnify-stage,.magnify-button").css("cursor",e+"-resize")};t.each(y,function(t,i){i.on(m.start,function(i){S(t,i)})}),s.on(m.move,function(e){if((e=e||window.event).preventDefault(),v&&!l.isMaximized){var o="touchmove"===e.type?e.originalEvent.targetTouches[0].pageX:e.clientX,s="touchmove"===e.type?e.originalEvent.targetTouches[0].pageY:e.clientY,r=o-b,g=s-z,d=function(t,i,e){var o=-i+$.w>n?i+$.l:$.l+$.w-n,a=-e+$.h>h?e+$.t:$.t+$.h-h;return{e:{width:Math.max(i+$.w,n)+"px"},s:{height:Math.max(e+$.h,h)+"px"},se:{width:Math.max(i+$.w,n)+"px",height:Math.max(e+$.h,h)+"px"},w:{width:Math.max(-i+$.w,n)+"px",left:o+"px"},n:{height:Math.max(-e+$.h,h)+"px",top:a+"px"},nw:{width:Math.max(-i+$.w,n)+"px",height:Math.max(-e+$.h,h)+"px",top:a+"px",left:o+"px"},ne:{width:Math.max(i+$.w,n)+"px",height:Math.max(-e+$.h,h)+"px",top:a+"px"},sw:{width:Math.max(-i+$.w,n)+"px",height:Math.max(e+$.h,h)+"px",left:o+"px"}}[t]}(I,r,g);t(i).css(d);var f=function(i,e,o){var s=e+$.w>n?D.w-k+e-M:n-($.w-D.w)-k-M,l=o+$.h>h?D.h-R+o+M:h-($.h-D.h)-R+M,r=-e+$.w>n?D.w-k-e-M:n-($.w-D.w)-k-M,g=-o+$.h>h?D.h-R-o+M:h-($.h-D.h)-R+M,d=t(a).position().left-M,f=t(a).position().top+M;return{e:{left:s>=-M?(s-M)/2+"px":d>s?d+"px":s+"px"},s:{top:l>=M?(l+M)/2+"px":f>l?f+"px":l+"px"},se:{top:l>=M?(l+M)/2+"px":f>l?f+"px":l+"px",left:s>=-M?(s-M)/2+"px":d>s?d+"px":s+"px"},w:{left:r>=-M?(r-M)/2+"px":d>r?d+"px":r+"px"},n:{top:g>=M?(g+M)/2+"px":f>g?f+"px":g+"px"},nw:{top:g>=M?(g+M)/2+"px":f>g?f+"px":g+"px",left:r>=-M?(r-M)/2+"px":d>r?d+"px":r+"px"},ne:{top:g>=M?(g+M)/2+"px":f>g?f+"px":g+"px",left:s>=-M?(s-M)/2+"px":d>s?d+"px":s+"px"},sw:{top:l>=M?(l+M)/2+"px":f>l?f+"px":l+"px",left:r>=-M?(r-M)/2+"px":d>r?d+"px":r+"px"}}[i]}(I,r,g);t(a).css(f)}}),s.on(m.end,function(i){r&&e({w:k,h:R},{w:t(o).width(),h:t(o).height()},o),v=!1,r=!1,t("html,body,.magnify-modal,.magnify-stage,.magnify-button").css("cursor","")})}})});